<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ è’é‡è¦ªå­å—äºŒåœ˜ ğŸœ</title>
  <style>
    /* --- åŸºç¤æ¨£å¼ --- */
    body { font-family: "Segoe UI", sans-serif; background: #f5f5f5; margin: 0; padding: 0; color: #333; }
    h1 { text-align: center; background-color: #ffffff; padding: 1.5em 1em; margin: 0; font-size: 1.8em; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); color: #4a5d23; }
    
    /* å®¹å™¨è¨­å®š */
    .container { 
      display: flex; 
      flex-wrap: wrap; 
      justify-content: center; 
      align-items: flex-start; 
      padding: 2em; 
      max-width: 1280px; 
      margin: auto; 
      gap: 20px; 
    }
    
    /* å·¦å´æ¬„ä½ */
    .left-column { 
      flex: 1; 
      min-width: 400px; 
      display: flex; 
      flex-direction: column; 
      gap: 20px; 
    }

    /* å³å´æ¬„ä½ */
    .right-column { 
      flex: 0 0 320px; 
      display: flex; 
      flex-direction: column; 
      gap: 1.5em; 
    }
    
    .content-box { background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 6px 10px rgba(0, 0, 0, 0.05); }

    /* --- å…¬å‘Šæ¬„ä½æ¨£å¼ --- */
    .news-grid { display: flex; gap: 15px; }
    .news-column { flex: 1; padding: 10px; border-radius: 8px; display: flex; flex-direction: column; }
    
    /* å°èŸ»åœ˜æ¨£å¼ */
    .news-ant { background: #fff0f5; border: 1px solid #ffc0cb; } 
    /* ç‚«èœ‚åœ˜æ¨£å¼ */
    .news-bee { background: #fffdf5; border: 1px solid #fceda6; } 

    .news-header {
      font-weight: bold; text-align: center; margin-bottom: 10px; padding-bottom: 5px;
      border-bottom: 2px solid rgba(0,0,0,0.05); font-size: 1.1em;
    }
    
    /* æ²è»¸è¨­å®š */
    .news-scroll-box { max-height: 250px; overflow-y: auto; padding-right: 5px; min-height: 50px; }
    .news-scroll-box::-webkit-scrollbar { width: 6px; }
    .news-scroll-box::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); border-radius: 3px; }
    .news-scroll-box::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius: 3px; }

    .news-item {
      background: #fff; margin-bottom: 8px; padding: 12px; border-radius: 6px;
      cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; border: 1px solid rgba(0,0,0,0.05);
    }
    .news-item:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .news-date { font-size: 0.85em; color: #888; display: block; margin-bottom: 4px; }
    .news-title { font-size: 1em; font-weight: bold; color: #333; line-height: 1.4; }

    /* --- æ‡¸æµ®è¦–çª— (Modal) --- */
    .modal-overlay {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.6); z-index: 2000;
      justify-content: center; align-items: center; padding: 20px;
    }
    .modal-content {
      background: #fff; width: 100%; max-width: 700px; max-height: 90vh;
      border-radius: 12px; overflow-y: auto; position: relative;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2); animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .modal-header { padding: 20px; background: #f9f9f9; border-bottom: 1px solid #eee; position: sticky; top: 0; z-index: 10; }
    .modal-title { font-size: 1.4em; font-weight: bold; color: #4a5d23; margin: 0; }
    .modal-date { color: #666; font-size: 0.9em; margin-top: 5px; }
    .close-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 2em; cursor: pointer; color: #888; line-height: 0.8; }
    .modal-body { padding: 25px; line-height: 1.6; }

    .section-block { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px dashed #eee; }
    .section-title { font-weight: bold; color: #2c5d47; margin-bottom: 10px; font-size: 1.1em; display:flex; align-items:center; gap:8px;}

    .check-list { list-style: none; padding: 0; margin: 0; }
    .check-list li { position: relative; padding-left: 28px; margin-bottom: 8px; }
    .check-list li::before { content: 'âœ”'; position: absolute; left: 0; top: 0; color: #5ca08e; font-weight: bold; }

    .kid-list-box { background: #eef9f5; border: 2px dashed #5ca08e; border-radius: 12px; padding: 15px; margin-top: 15px; }
    .kid-list li { font-size: 1.15em; color: #333; padding-left: 32px; }
    .kid-list li::before { content: 'ğŸ’'; top: 1px; }

    .adult-list-box { background: #f4f6f8; border: 2px solid #dde1e5; border-radius: 12px; padding: 15px; margin-top: 15px; }
    .adult-list li { font-size: 1em; color: #444; }
    
    /* é€£çµæ¨£å¼ï¼šè®“ä½¿ç”¨è€…çŸ¥é“å¯ä»¥é» */
    .link-text { color: #5ca08e; text-decoration: underline; font-weight: bold; word-break: break-all; }
    .link-text:hover { color: #365119; }

    /* --- RWD --- */
    @media (max-width: 960px) {
      .container { padding: 1em; gap: 1em; }
      .left-column { min-width: 0; }
    }
    @media (max-width: 768px) {
      .container { flex-direction: column; }
      .left-column { width: 100%; }
      .right-column { width: 100%; flex: auto; order: -1; }
      .news-grid { flex-direction: column; }
      .news-scroll-box { max-height: 200px; }
    }
    .home-btn{position:fixed;top:18px;right:18px;background:#4a5d23;color:#fff;padding:8px 14px;border-radius:8px;font-weight:bold;text-decoration:none;box-shadow:0 3px 8px rgba(0,0,0,.15);z-index:1000;}
    /* èˆŠæœ‰æ¨£å¼ä¿ç•™ */
    .calendar-title { text-align: center; color: #4a5d23; margin: 0 0 10px 0; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
    .calendar-legend { text-align: center; margin-bottom: 15px; font-size: 0.95em; }
    .calendar-frame { width: 100%; height: 600px; border: 0; }
    .form-box { background: #e9f6f0; border-radius: 12px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); display: flex; justify-content: space-between; align-items: center; border-left: 5px solid #5ca08e; }
    .month { font-size: 1.1em; font-weight: bold; color: #2c5d47; }
    .title { font-size: 0.95em; color: #555; }
    .btn { background-color: #5ca08e; color: white; padding: 8px 14px; border: none; border-radius: 6px; text-decoration: none; font-weight: bold; white-space: nowrap; }
    .action-buttons { display: flex; flex-direction: column; gap: 10px; }
    .query-btn { background: #fdf6e3; padding: 15px; border-radius: 12px; font-size: 1.1em; text-align: center; text-decoration: none; color: #4a5d23; border: 1px solid #ddd; font-weight: bold; }
  </style>
</head>
<body>
  <a href="https://sowtnn02.github.io/home/index" class="home-btn">ğŸ  å›é¦–é </a>
  <h1><a href="index.html" style="text-decoration: none; color: inherit;">è’é‡ä¿è­·å”æœƒè¦ªå­åœ˜å—äºŒåœ˜<br>ğŸ ï¼ˆèœ‚ / èŸ»ï¼‰ğŸœ</a></h1>
  
  <div class="container">
    
    <div class="left-column">
      <div class="content-box">
        <h3 style="text-align:center; color:#4a5d23; margin-top:0;">ğŸ“¢ åœ˜å‹™ä½ˆå‘Šæ¬„</h3>
        <div class="news-grid">
          
          <div class="news-column news-ant">
            <div class="news-header"><span style="color:#d81b60;">â—</span> å°èŸ»åœ˜</div>
            <div id="ant-news-list" class="news-scroll-box">
              <div style="text-align:center; padding:20px; color:#aaa;">è¼‰å…¥ä¸­...</div>
            </div>
          </div>

          <div class="news-column news-bee">
            <div class="news-header"><span style="color:#f6bf26;">â—</span> ç‚«èœ‚åœ˜</div>
            <div id="bee-news-list" class="news-scroll-box">
              <div style="text-align:center; padding:20px; color:#aaa;">è¼‰å…¥ä¸­...</div>
            </div>
          </div>

        </div>
      </div>

      <div class="content-box">
        <h3 class="calendar-title">ğŸ“… åœ˜é›†æœƒè¡Œäº‹æ›†</h3>
        <div class="calendar-legend">
          <span style="color: #d81b60;">ğŸœâ— å°èŸ»åœ˜</span>
          <span style="color: #e67c73;">â— èŸ»åœ˜å·¥ä½œè¡Œç¨‹ ğŸœ</span><br>
          <span style="color: #f6bf26;">ğŸ â— ç‚«èœ‚åœ˜</span>
          <span style="color: #f09300;">â— èœ‚åœ˜å·¥ä½œè¡Œç¨‹ ğŸ</span>
        </div>
        <iframe src="https://calendar.google.com/calendar/embed?height=600&wkst=2&ctz=Asia%2FTaipei&showTitle=0&showTz=0&src=YjVlNzdhNmY3ZjNlYTRlMzY4YTg2ZmMyZDg2ZThiOThlZGMwMTNiYWExZGMzNjY0NjczZTU0MjZlMjM3M2JmYkBncm91cC5jYWxlbmRhci5nb29nbGUuY29t&src=YWZhY2Y2ODk0ZDgwMGIyNGNkZmJiNDdkODRjMTI3YTFlZTRjN2MwYjZkOWY2MDFiNmZjN2QxMGMwY2U2ZmViMEBncm91cC5jYWxlbmRhci5nb29nbGUuY29t&src=NWJkY2JiMTA1ZjcyYzcyZjc1N2Q4OTNmOTQ4MjUzMmRjYjIzMjdkYjgzMjE2NWJjMDRiODFmNzYyYmIxOThiYUBncm91cC5jYWxlbmRhci5nb29nbGUuY29t&src=NWRmYjA3M2VlZTBiZGU2MGI1MzJhOTdjZTM5YjFkNTVjZWZhMWM2YzkwYjkyMDY5NTAwMDNhN2Y4OTdhMjUxNkBncm91cC5jYWxlbmRhci5nb29nbGUuY29t&color=%23e67c73&color=%23d81b60&color=%23f09300&color=%23f6bf26" class="calendar-frame" frameborder="0" scrolling="no"></iframe>
      </div>
    </div>

    <div class="right-column">
      <div id="form-list"><div style="text-align: center; color: #666; padding: 20px;">è¼‰å…¥è¡¨å–®ä¸­...</div></div>
      <div class="action-buttons">
        <a class="query-btn" href="search1.html">ğŸ” æŸ¥è©¢å‡ºå¸­ç´€éŒ„</a>
        <a class="query-btn" href="searchallteam.html">ğŸ“‹ å°éšŠå‡ºå¸­ç¸½è¦½</a>
      </div>
    </div>
  </div>

  <div id="news-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <button class="close-btn" onclick="closeModal()">Ã—</button>
        <h2 class="modal-title" id="m-title">æ¨™é¡Œ</h2>
        <div class="modal-date" id="m-date">æ—¥æœŸ</div>
      </div>
      <div class="modal-body" id="m-body">
        </div>
    </div>
  </div>

  <script>
    const SHEET_ID = "1_yffIOhto8dSwRCcmndN1KucMddrcqcuNgGM7yU9gH4";

    // --- æ–°å¢å·¥å…·å‡½å¼ï¼šè™•ç†ç¶²å€é€£çµèˆ‡æ›è¡Œ ---
    function formatContent(text) {
      if (!text) return "";
      // 1. å…ˆç”¨ Regex æŠŠ http/https é–‹é ­çš„ç¶²å€è®Šé€£çµ
      const urlRegex = /(https?:\/\/[^\s]+)/g;
      const linkedText = text.replace(urlRegex, function(url) {
        return `<a href="${url}" target="_blank" class="link-text">${url}</a>`;
      });
      // 2. å†æŠŠæ›è¡Œç¬¦è™Ÿ \n è®Šæˆ <br>
      return linkedText.replace(/\n/g, "<br>");
    }

    async function fetchNews(group, containerId, type) {
      const url = `https://opensheet.elk.sh/${SHEET_ID}/${group}_News`;
      const container = document.getElementById(containerId);
      
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error("API Error");
        let data = await res.json();

        // å–å¾—ä»Šå¤© (è¨­ç‚º 00:00:00 ä»¥åˆ©æ¯”è¼ƒ)
        const today = new Date();
        today.setHours(0, 0, 0, 0); 

        data = data.filter(item => {
          // 1. æ’ç¨‹åŠŸèƒ½ï¼šæª¢æŸ¥é–‹å§‹æ—¥æœŸ (date)
          // å¦‚æœå…¬å‘Šæ—¥æœŸ (item.date) å¤§æ–¼ ä»Šå¤©ï¼Œä»£è¡¨æ˜¯æœªä¾†å…¬å‘Šï¼Œè¦éš±è—
          const startDate = new Date(item.date);
          startDate.setHours(0, 0, 0, 0); // ç¢ºä¿åªæ¯”è¼ƒæ—¥æœŸ
          if (startDate > today) return false;

          // 2. ä¸‹æ¶åŠŸèƒ½ï¼šæª¢æŸ¥ä¸‹æ¶æ—¥æœŸ (expiryDate)
          if (!item.expiryDate) return true; // æ²’è¨­æœŸé™å°±é¡¯ç¤º
          const expiry = new Date(item.expiryDate);
          expiry.setHours(0, 0, 0, 0);
          return expiry >= today; // ä¸‹æ¶æ—¥å¿…é ˆé‚„æ²’é
        });

        // æ’åºï¼šæ—¥æœŸæ–° -> èˆŠ
        data.sort((a, b) => new Date(b.date) - new Date(a.date));

        // æ¸²æŸ“
        let html = "";
        if (data.length === 0) {
          html = "<div style='text-align:center; color:#999; font-size:0.9em; padding:20px;'>ç›®å‰ç„¡å…¬å‘Š</div>";
        } else {
          data.forEach(item => {
            item.type = type; 
            html += `
              <div class="news-item" onclick='openModal(${JSON.stringify(item)})'>
                <span class="news-date">${item.date}</span>
                <div class="news-title">${item.title}</div>
              </div>
            `;
          });
        }
        container.innerHTML = html;

      } catch (error) {
        console.error("ç„¡æ³•è¼‰å…¥å…¬å‘Š:", error);
        container.innerHTML = "<div style='text-align:center; color:red; padding:10px;'>è¼‰å…¥å¤±æ•—</div>";
      }
    }

    fetchNews("Ant", "ant-news-list", "ant");
    fetchNews("Bee", "bee-news-list", "bee");

    // --- æ‡¸æµ®è¦–çª—é‚è¼¯ ---
    function openModal(item) {
      document.getElementById("m-title").innerText = item.title;
      document.getElementById("m-date").innerText = "ç™¼å¸ƒæ—¥æœŸï¼š" + item.date;
      
      let bodyHtml = "";

      // A: è¡Œç¨‹/äº¤é€š (ä½¿ç”¨ formatContent è™•ç†é€£çµ)
      if(item.contentA) {
        bodyHtml += `
          <div class="section-block">
            <div class="section-title">ğŸ“ è¡Œç¨‹èˆ‡å…§å®¹</div>
            <div>${formatContent(item.contentA)}</div>
          </div>`;
      }

      // B: ç‰©è³‡å‹Ÿé›† (ä½¿ç”¨ formatContent è™•ç†é€£çµ)
      if(item.contentB) {
        bodyHtml += `
          <div class="section-block" style="background:#fffbe6; padding:15px; border-radius:8px;">
            <div class="section-title">ğŸ”¥ ç‰©è³‡èˆ‡äººåŠ›å‹Ÿé›†</div>
            <div>${formatContent(item.contentB)}</div>
          </div>`;
      }

      // D: å¤§äººæ¸…å–®
      if(item.noteD || item.listD) {
        bodyHtml += `<div class="adult-list-box">`;
        bodyHtml += `<div class="section-title">ğŸ§‘ å¤§äººæ”œå¸¶æ¸…å–®</div>`;
        if(item.noteD) bodyHtml += `<div style="margin-bottom:10px; color:#555; font-weight:500;">${item.noteD}</div>`;
        if(item.listD) {
          const listItems = item.listD.split('\n').map(line => `<li>${line}</li>`).join('');
          bodyHtml += `<ul class="check-list adult-list">${listItems}</ul>`;
        }
        bodyHtml += `</div>`;
      }

      // C: å°å­©æ¸…å–®
      if(item.noteC || item.listC) {
        const kidTitle = (item.type === 'ant') ? 'ğŸœ å°èŸ»èƒŒåŒ…æª¢æŸ¥' : 'ğŸ å°èœ‚èƒŒåŒ…æª¢æŸ¥';
        bodyHtml += `<div class="kid-list-box">`;
        bodyHtml += `<div class="section-title">${kidTitle}</div>`;
        if(item.noteC) bodyHtml += `<div style="margin-bottom:10px; font-weight:bold; color:#d81b60;">${item.noteC}</div>`;
        if(item.listC) {
          const listItems = item.listC.split('\n').map(line => `<li>${line}</li>`).join('');
          bodyHtml += `<ul class="check-list kid-list">${listItems}</ul>`;
        }
        bodyHtml += `</div>`;
      }

      document.getElementById("m-body").innerHTML = bodyHtml;
      document.getElementById("news-modal").style.display = "flex";
    }

    function closeModal() { document.getElementById("news-modal").style.display = "none"; }
    document.getElementById("news-modal").addEventListener("click", function(e) { if(e.target === this) closeModal(); });

    // --- è¼‰å…¥è¡¨å–® (ç¶­æŒä¸è®Š) ---
    const SHEET_URL = "https://opensheet.elk.sh/13v4T864SSZGSoNiIPGOY12mfzT2q5sbvDrarusC_zLE/%E8%9C%82%E8%9F%BB";
    async function loadForms() {
      try {
        const res = await fetch(SHEET_URL);
        const data = await res.json();
        const container = document.getElementById("form-list");
        container.innerHTML = "";
        if (data.length === 0) { container.innerHTML = "<div style='text-align:center; padding:20px;'>ç›®å‰æ²’æœ‰é–‹æ”¾çš„è¡¨å–®</div>"; return; }
        data.sort((a, b) => a.month.localeCompare(b.month));
        data.forEach(item => {
          const div = document.createElement("div");
          div.className = "form-box";
          div.innerHTML = `<div style="display: flex; flex-direction: column;"><div class="month">${item.month}</div><div class="title">${item.title}</div></div><a class="btn" href="${item.form_url}" target="_blank">å¡«å¯«</a>`;
          container.appendChild(div);
        });
      } catch (error) { console.error("ç„¡æ³•è¼‰å…¥è¡¨å–®:", error); container.innerHTML = "<div style='text-align:center; color:red;'>ç„¡æ³•è¼‰å…¥è¡¨å–®</div>"; }
    }
    loadForms();
  </script>
</body>
</html>
